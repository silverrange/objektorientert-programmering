<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title></title>
</head>

<body>

  <canvas id="canvas" height="400" width="600"></canvas>

  <script>
    class Boble {
      constructor(x, y, r, color) {
        this.x = x;
        this.y = y;
        this.r = r;
        this.farge = color;
        this.initFarge = color;

      }

      constrain() {
        if (this.x - this.r < 0) {
          this.x = this.r + 5;
        } else if (this.x + this.r > canvas.width) {
          this.x = canvas.width - this.r - 5;
        } else if (this.y - this.r < 0) {
          this.y = this.r + 5;
        } else if (this.y + this.r > canvas.height) {
          this.y = canvas.height - this.r - 5;
        }
      }

      flytt() {
        this.x = this.x + Math.floor(Math.random() * 10 - 5);
        this.y = this.y + Math.floor(Math.random() * 10 - 5);
      }

      vis() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.r, 0, 2 * Math.PI);
        ctx.fillStyle = this.farge;
        ctx.fill();
        ctx.strokeStyle = "white";
        ctx.stroke();
      }

      inneholder(x, y) {
        let a = this.x - x;
        let b = this.y - y;
        let d = Math.sqrt(a * a + b * b);

        if (d < this.r) {
          return true;
        } else {
          return false;
        }
      }
    };

    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    canvas.addEventListener("mousemove", musbeveg, false);
    canvas.addEventListener("mousedown", musklikk, false);

    var bobler = [];

    setInterval(tegn, 100);
    setInterval(makeBubble, 1000);

    function reset() {
      ctx.fillStyle = "black";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function tegn() {
      reset();
      for (let i = 0; i < bobler.length; i++) {
        bobler[i].flytt();
        bobler[i].constrain();
        bobler[i].vis();
      }
    }

    function musbeveg(event) {
      for (let i = 0; i < bobler.length; i++) {
        if (bobler[i].inneholder(event.x, event.y)) {
          bobler[i].farge = "red";
        } else {
          bobler[i].farge = bobler[i].initFarge;
        }
      }
    }

    function musklikk(event) {
      var valgtboble = false;

      for (let i = 0; i < bobler.length; i++) {
        if (bobler[i].inneholder(event.x, event.y)) {
          bobler.splice(i, 1);
          valgtboble = true;
        }
      }

      if (valgtboble == false) {
        makeBubble(event.x, event.y);
      }
    }

    function makeBubble(xpos, ypos) {
      let r = Math.floor(Math.random() * 40 + 10);
      let color = makeColor();
      if (!xpos || !ypos) {
        xpos = Math.floor(Math.random() * canvas.width + r) - r;
        ypos = Math.floor(Math.random() * canvas.height + r) - r;

      }
      let b = new Boble(xpos, ypos, r, color);
      bobler.push(b);
    }

    function makeColor() {
      var red = Math.floor(Math.random() * 256);
      var green = Math.floor(Math.random() * 256);
      var blue = Math.floor(Math.random() * 256);
      var rgb = 'rgb(' + red + ',' + green + ',' + blue + ')';
      return rgb;
    }
  </script>

</body>

</html>
